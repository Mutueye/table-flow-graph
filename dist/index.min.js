!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("lodash-es")):"function"==typeof define&&define.amd?define(["exports","lodash-es"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).TableFlowGraph={},t.lodashEs)}(this,(function(t,e){"use strict";function n(t,e,n){void 0===n&&(n=null);var i=document.createElement(t);return i.className=e,n&&n.appendChild(i),i}function i(t){t.remove?t.remove():t.parentNode&&t.parentNode.removeChild(t)}function o(t,e){for(var n in e){var i=e[n];"number"==typeof i&&(i="".concat(i,"px")),t.style[n]=i}return t}var s={edit:'<svg t="1657530672054" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="8212" width="200" height="200"><path d="M712.96 268.373333l-128-128c-16.64-16.64-43.52-16.64-60.16 0l-384 384c-8.106667 8.106667-12.373333 18.773333-12.373333 30.293334v128c0 23.466667 19.2 42.666667 42.666666 42.666666h128c11.093333 0 22.186667-4.266667 30.293334-12.373333l264.106666-264.106667 22.186667-22.186666 97.706667-97.706667c16.213333-16.64 16.213333-43.946667-0.426667-60.586667zM281.173333 640H213.333333v-67.84l232.533334-232.533333 67.84 67.84L281.173333 640z m292.693334-292.693333l-67.84-67.84L554.666667 230.826667 622.506667 298.666667l-48.64 48.64zM853.333333 896H170.666667c-23.466667 0-42.666667-19.2-42.666667-42.666667s19.2-42.666667 42.666667-42.666666h682.666666c23.466667 0 42.666667 19.2 42.666667 42.666666s-19.2 42.666667-42.666667 42.666667z" p-id="8213"></path></svg>',plus:'<svg t="1657533725416" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4984" width="200" height="200"><path d="M512 85.333333C276.906667 85.333333 85.333333 276.906667 85.333333 512s191.573333 426.666667 426.666667 426.666667 426.666667-191.573333 426.666667-426.666667S747.093333 85.333333 512 85.333333z m0 768c-188.16 0-341.333333-153.173333-341.333333-341.333333s153.173333-341.333333 341.333333-341.333333 341.333333 153.173333 341.333333 341.333333-153.173333 341.333333-341.333333 341.333333z" p-id="4985"></path><path d="M725.333333 512c0 23.466667-19.2 42.666667-42.666666 42.666667h-128v128c0 23.466667-19.2 42.666667-42.666667 42.666666s-42.666667-19.2-42.666667-42.666666v-128H341.333333c-23.466667 0-42.666667-19.2-42.666666-42.666667s19.2-42.666667 42.666666-42.666667h128V341.333333c0-23.466667 19.2-42.666667 42.666667-42.666666s42.666667 19.2 42.666667 42.666666v128h128c23.466667 0 42.666667 19.2 42.666666 42.666667z" p-id="4986"></path></svg>',x:'<svg t="1657533744067" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5120" width="200" height="200"><path d="M512 85.333333C276.906667 85.333333 85.333333 276.906667 85.333333 512s191.573333 426.666667 426.666667 426.666667 426.666667-191.573333 426.666667-426.666667S747.093333 85.333333 512 85.333333z m0 768c-188.16 0-341.333333-153.173333-341.333333-341.333333s153.173333-341.333333 341.333333-341.333333 341.333333 153.173333 341.333333 341.333333-153.173333 341.333333-341.333333 341.333333z" p-id="5121"></path><path d="M663.04 602.453333c16.64 16.64 16.64 43.52 0 60.16-8.533333 8.533333-19.2 12.373333-30.293333 12.373334-11.093333 0-21.76-4.266667-30.293334-12.373334L512 572.16l-90.453333 90.453333c-8.533333 8.533333-19.2 12.373333-30.293334 12.373334-11.093333 0-21.76-4.266667-30.293333-12.373334-16.64-16.64-16.64-43.52 0-60.16l90.453333-90.453333-90.453333-90.453333c-16.64-16.64-16.64-43.52 0-60.16 16.64-16.64 43.52-16.64 60.16 0l90.453333 90.453333 90.453334-90.453333c16.64-16.64 43.52-16.64 60.16 0 16.64 16.64 16.64 43.52 0 60.16l-89.6 90.453333 90.453333 90.453333z" p-id="5122"></path></svg>',expand:'<svg t="1658744557448" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="9385" width="200" height="200"><path d="M170.666667 394.24c-23.466667 0-42.666667-19.2-42.666667-42.666667V170.666667c0-23.466667 19.2-42.666667 42.666667-42.666667h180.906666c23.466667 0 42.666667 19.2 42.666667 42.666667s-19.2 42.666667-42.666667 42.666666H213.333333v138.24c0 23.466667-19.2 42.666667-42.666666 42.666667zM672.426667 896c-23.466667 0-42.666667-19.2-42.666667-42.666667s19.2-42.666667 42.666667-42.666666H810.666667v-138.24c0-23.466667 19.2-42.666667 42.666666-42.666667s42.666667 19.2 42.666667 42.666667V853.333333c0 23.466667-19.2 42.666667-42.666667 42.666667h-180.906666zM170.666667 896c-11.52 0-22.186667-4.693333-30.293334-12.373333-8.106667-8.106667-12.373333-18.773333-12.373333-30.293334v-180.906666c0-23.466667 19.2-42.666667 42.666667-42.666667s42.666667 19.2 42.666666 42.666667V810.666667h138.24c23.466667 0 42.666667 19.2 42.666667 42.666666s-19.2 42.666667-42.666667 42.666667H170.666667zM853.333333 394.24c-23.466667 0-42.666667-19.2-42.666666-42.666667V213.333333h-138.24c-23.466667 0-42.666667-19.2-42.666667-42.666666s19.2-42.666667 42.666667-42.666667H853.333333c11.52 0 22.186667 4.693333 30.293334 12.373333 8.106667 8.106667 12.373333 18.773333 12.373333 30.293334v180.906666c0 23.466667-19.2 42.666667-42.666667 42.666667z" p-id="9386"></path></svg>',move:'<svg t="1658744606420" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="9520" width="200" height="200"><path d="M426.666667 512c0 23.466667-19.2 42.666667-42.666667 42.666667H230.826667L285.866667 609.706667c16.64 16.64 16.64 43.52 0 60.16-8.106667 8.533333-19.2 12.373333-30.293334 12.373333s-21.76-4.266667-30.293333-12.373333l-128-128c-16.64-16.64-16.64-43.52 0-60.16l128-128c16.64-16.64 43.52-16.64 60.16 0 16.64 16.64 16.64 43.52 0 60.16l-54.613333 55.466666H384c23.466667 0 42.666667 19.2 42.666667 42.666667zM926.293333 542.293333l-128 128c-8.106667 8.533333-19.2 12.373333-30.293333 12.373334s-21.76-4.266667-30.293333-12.373334c-16.64-16.64-16.64-43.52 0-60.16l55.04-55.04H640c-23.466667 0-42.666667-19.2-42.666667-42.666666s19.2-42.666667 42.666667-42.666667h153.173333L738.133333 414.72c-16.64-16.64-16.64-43.52 0-60.16 16.64-16.64 43.52-16.64 60.16 0l128 128c16.64 15.786667 16.64 43.093333 0 59.733333zM670.293333 798.293333l-128 128c-8.106667 8.106667-18.773333 12.373333-30.293333 12.373334s-22.186667-4.693333-30.293333-12.373334l-128-128c-16.64-16.64-16.64-43.52 0-60.16 16.64-16.64 43.52-16.64 60.16 0l55.04 55.04V640c0-23.466667 19.2-42.666667 42.666666-42.666667s42.666667 19.2 42.666667 42.666667v153.173333l55.04-55.04c16.64-16.64 43.52-16.64 60.16 0 17.493333 16.213333 17.493333 43.52 0.853333 60.16zM670.293333 286.293333c-16.64 16.64-43.52 16.64-60.16 0l-55.466666-55.466666V384c0 23.466667-19.2 42.666667-42.666667 42.666667s-42.666667-19.2-42.666667-42.666667V230.826667l-55.04 55.466666C405.76 294.4 395.093333 298.666667 384 298.666667s-21.76-4.266667-30.293333-12.373334C337.066667 269.653333 337.066667 242.773333 353.706667 226.133333l128-128c16.64-16.64 43.52-16.64 60.16 0l128 128c17.066667 16.213333 17.066667 43.52 0.426666 60.16z" p-id="9521"></path></svg>',remove:'<svg t="1658744626586" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="9655" width="200" height="200"><path d="M405.333333 768c-23.466667 0-42.666667-19.2-42.666666-42.666667v-256c0-23.466667 19.2-42.666667 42.666666-42.666666s42.666667 19.2 42.666667 42.666666v256c0 23.466667-19.2 42.666667-42.666667 42.666667zM618.666667 768c-23.466667 0-42.666667-19.2-42.666667-42.666667v-256c0-23.466667 19.2-42.666667 42.666667-42.666666s42.666667 19.2 42.666666 42.666666v256c0 23.466667-19.2 42.666667-42.666666 42.666667z" p-id="9656"></path><path d="M896 256h-170.666667V128c0-23.466667-19.2-42.666667-42.666666-42.666667H341.333333c-23.466667 0-42.666667 19.2-42.666666 42.666667v128H128c-23.466667 0-42.666667 19.2-42.666667 42.666667s19.2 42.666667 42.666667 42.666666h42.666667v554.666667c0 23.466667 19.2 42.666667 42.666666 42.666667h597.333334c23.466667 0 42.666667-19.2 42.666666-42.666667V341.333333h42.666667c23.466667 0 42.666667-19.2 42.666667-42.666666s-19.2-42.666667-42.666667-42.666667zM384 170.666667h256v85.333333H384V170.666667z m384 682.666666H256V341.333333h512v512z" p-id="9657"></path></svg>',delete_row:'<svg t="1659516333894" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="12036" width="200" height="200"><path d="M663.04 602.453333c16.64 16.64 16.64 43.52 0 60.16-8.533333 8.106667-19.2 12.373333-30.293333 12.373334-11.093333 0-21.76-4.266667-30.293334-12.373334L512 572.586667l-90.453333 90.453333c-8.106667 8.106667-19.2 12.373333-30.293334 12.373333-11.093333 0-21.76-4.266667-30.293333-12.373333-16.64-16.64-16.64-43.52 0-60.16l90.453333-90.453333-90.453333-90.88c-16.64-16.64-16.64-43.52 0-60.586667 16.64-16.64 43.52-16.64 60.16 0l90.453333 90.453333 90.453334-90.453333c16.64-16.64 43.52-16.64 60.16 0 16.64 16.64 16.64 43.52 0 60.586667L572.16 512l90.88 90.453333zM896 170.666667c0 23.466667-19.2 42.666667-42.666667 42.666666H170.666667c-23.466667 0-42.666667-19.2-42.666667-42.666666s19.2-42.666667 42.666667-42.666667h682.666666c23.466667 0 42.666667 19.2 42.666667 42.666667zM853.333333 896H170.666667c-23.466667 0-42.666667-19.2-42.666667-42.666667s19.2-42.666667 42.666667-42.666666h682.666666c23.466667 0 42.666667 19.2 42.666667 42.666666s-19.2 42.666667-42.666667 42.666667z" p-id="12037"></path></svg>',delete_col:'<svg t="1659516365239" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="12171" width="200" height="200"><path d="M421.546667 663.04c-16.64 16.64-43.52 16.64-60.16 0-8.106667-8.533333-12.373333-19.2-12.373334-30.293333 0-11.093333 4.266667-21.76 12.373334-30.293334l90.453333-90.453333-90.88-90.453333c-8.106667-8.106667-12.373333-19.2-12.373333-30.293334 0-11.093333 4.266667-21.76 12.373333-30.293333 16.64-16.64 43.52-16.64 60.16 0l90.453333 90.453333 90.453334-90.453333c16.64-16.64 43.52-16.64 60.586666 0 16.64 16.64 16.64 43.52 0 60.16L572.16 512l90.453333 90.453333c16.64 16.64 16.64 43.52 0 60.16-16.64 16.64-43.52 16.64-60.586666 0L512 572.16l-90.453333 90.88zM853.333333 896c-23.466667 0-42.666667-19.2-42.666666-42.666667V170.666667c0-23.466667 19.2-42.666667 42.666666-42.666667s42.666667 19.2 42.666667 42.666667v682.666666c0 23.466667-19.2 42.666667-42.666667 42.666667zM128 853.333333V170.666667c0-23.466667 19.2-42.666667 42.666667-42.666667s42.666667 19.2 42.666666 42.666667v682.666666c0 23.466667-19.2 42.666667-42.666666 42.666667s-42.666667-19.2-42.666667-42.666667z" p-id="12172"></path></svg>'},r=function(t,e){var n,i;if(s[e.name]){this.element=(n=s[e.name],(i=document.createElement("div")).innerHTML=n.trim(),i.firstChild);var r=e.size?e.size:16,a=e.color?e.color:"#333333",l={width:r+"px",height:r+"px"};e.color&&(l.fill=a,l.color=a),o(this.element,l),e.style&&o(this.element,e.style),e.className&&this.element.setAttribute("class",e.className),this.element.classList.add("tfgraph-icon"),t.appendChild(this.element)}},a=function(){function t(t,e){var n=this;this.targetElement=t,this.options=e,this.rendered=!1,this.targetElement.addEventListener("mouseenter",(function(){return n.mouseEnter()})),this.targetElement.addEventListener("mouseleave",(function(){return n.mouseLeave()}))}return t.prototype.render=function(){var t=this.options,e=t.placement,i=void 0===e?"top":e,s=t.label,r=this.targetElement.getBoundingClientRect();this.element=n("div","tfgraph-tooltip",document.body),o(this.element,{left:r.left+.5*r.width+"px",top:r.top+.5*r.height+"px"}),this.areaElement=n("div","tfgraph-tooltip-area ".concat(i),this.element),this.boxElement=n("div","tfgraph-tooltip-box",this.areaElement),this.arrowElement=n("div","tfgraph-tooltip-arrow",this.areaElement),s&&(this.boxElement.innerHTML=s);var a=this.areaElement.getBoundingClientRect(),l=this.arrowElement.getBoundingClientRect(),h={},c={};switch(i){case"top":h.left=-.5*a.width+"px",h.bottom=.5*r.height+10+"px",c.left=.5*(a.width-l.width)+"px";break;case"right":h.left=.5*r.width+"px",h.top=-.5*a.height+"px",c.top=.5*(a.height-l.height)+"px";break;case"bottom":h.left=-.5*a.width+"px",h.top=.5*r.height+"px",c.left=.5*(a.width-l.width)+"px";break;case"left":h.right=.5*r.width+"px",h.top=-.5*a.height+"px",c.top=.5*(a.height-l.height)+"px"}o(this.areaElement,h),o(this.arrowElement,c),this.rendered=!0,this.showTimeoutId&&(window.clearTimeout(this.showTimeoutId),this.showTimeoutId=null)},t.prototype.dismiss=function(){var t=this;this.rendered=!1,this.targetElement.removeEventListener("mouseenter",(function(){return t.mouseEnter()})),this.targetElement.removeEventListener("mouseleave",(function(){return t.mouseLeave()})),this.element&&i(this.element)},t.prototype.mouseEnter=function(){var t=this;this.rendered||this.showTimeoutId||(this.showTimeoutId=window.setTimeout((function(){t.render()}),500)),this.dismissTimeoutId&&window.clearTimeout(this.dismissTimeoutId)},t.prototype.mouseLeave=function(){var t=this;this.showTimeoutId&&(window.clearTimeout(this.showTimeoutId),this.showTimeoutId=null),this.dismissTimeoutId=window.setTimeout((function(){t.dismiss()}),50)},t}(),l=function(){function t(t,e){var i=this,o=e.label,s=e.type,l=e.onClick,h=e.icon,c=e.tooltip,d="tfgraph-button is-hoverable";e.className&&(d+=" "+e.className),d+=" "+(s||"default"),this.element=n("button",d,t),h&&new r(this.element,{name:h,size:16,className:o?"mr-5":""}),o&&(n("span","",this.element).innerHTML=o),c&&(this.btnToolTip=new a(this.element,{label:c})),this.element.addEventListener("click",(function(t){i.btnToolTip&&i.btnToolTip.dismiss(),i.disabled||"function"==typeof l&&l(t)}))}return t.prototype.setDisabled=function(){this.disabled=!0,this.element.classList.add("disabled")},t.prototype.setEnabled=function(){this.disabled=!1,this.element.classList.remove("disabled")},t}(),h=function(){function t(t,e){var i=this;this.btnList=[];var o=e.items,s=e.initialActiveIndex,r=e.onChange;this.element=n("div","tfgraph-toggler",t),this.indicatorEl=n("div","tfgraph-toggler-indicator",this.element),this.btnContainerEl=n("div","flex flex-row items-center",this.element),o.forEach((function(t,e){var o=n("button","tfgraph-toggler-btn",i.btnContainerEl);o.innerHTML=t.label,i.btnList.push({itemData:t,el:o,index:e}),o.addEventListener("click",(function(){i.setActive(e),"function"==typeof r&&r(t,e)}))})),this.setActive("number"==typeof s?s:0)}return t.prototype.setActive=function(t){this.activeIndex!==t&&("number"==typeof this.activeIndex&&this.btnList[this.activeIndex].el.classList.remove("active"),this.activeIndex=t,this.btnList[t].el.classList.add("active"),this.setActiveIndicator())},t.prototype.setActiveIndicator=function(){var t=this.btnContainerEl.getBoundingClientRect(),e=this.btnList[this.activeIndex].el.getBoundingClientRect();o(this.indicatorEl,{width:e.width+"px",left:e.left-t.left+4+"px"})},t.prototype.setDisabled=function(){this.disabled=!0,this.element.classList.add("disabled")},t.prototype.setEnabled=function(){this.disabled=!1,this.element.classList.remove("disabled")},t}(),c=function(){function t(t,e){var i=this;this.graphInstance=e,this.element=n("div","tfgraph-toolbar",t),this.modeToggler=new h(this.element,{items:[{label:this.graphInstance.options.labels.editMode,id:"edit"},{label:this.graphInstance.options.labels.previewMode,id:"preview"}],onChange:function(t){e.changeMode(t.id)}});var o=n("div","flex-row items-center",this.element);this.newColumnBtn=new l(o,{icon:"plus",label:this.graphInstance.options.labels.addColumn,type:"primary",onClick:function(){return i.addColumn(i.graphInstance)}}),this.disabledMask=n("div","tfgraph-toolbar-mask hidden",this.element),this.setToolbarState()}return t.prototype.addColumn=function(t){"function"==typeof t.options.onAddColumn&&t.options.onAddColumn()},t.prototype.disable=function(){this.disabledMask.classList.remove("hidden")},t.prototype.enable=function(){this.disabledMask.classList.add("hidden")},t.prototype.setToolbarState=function(){this.graphInstance.options.totalColumns>=this.graphInstance.options.maxColumns?this.newColumnBtn.element.classList.add("hidden"):this.newColumnBtn.element.classList.remove("hidden")},t}(),d=function(){function t(t,e,n,i,o){this.graphInstance=o,this.row=n,this.column=i,this.element=this.createTabelCell(e,n,i,this.graphInstance),t.appendChild(this.element)}return t.prototype.createTabelCell=function(t,e,i,o){var s=n("div","tfgraph-cell");if(s.setAttribute("id","".concat(o.id,"_cell_").concat(e,"_").concat(i)),t){var r=n("button","tfgraph-node");t.type&&r.classList.add(t.type),t.isBtn&&"edit"!==this.graphInstance.mode&&r.classList.add("isBtn"),"function"==typeof this.graphInstance.options.renderNode?r.appendChild(this.graphInstance.options.renderNode(t,r)):r.innerText=t.title,s.appendChild(r),this.hasNode=!0,this.nodeEl=r,this.nodeData=t,this.rowSpan=t.rowSpan,this.colSpan=t.colSpan}else this.rowSpan=1,this.colSpan=1,this.hasNode=!1;return s.style.minHeight=80*this.rowSpan+"px",s},t.prototype.setEditControls=function(){var t=this;this.controlLayer=n("div","tfgraph-cell-control-layer hidden",this.element),this.nodeData?(new l(this.controlLayer,{icon:"move",type:"primary",tooltip:this.graphInstance.options.labels.moveNode,className:"absolute left-6 top-6 p-0 sm w-28 btn-tl",onClick:function(){t.graphInstance.tableController.startMoving(t)}}),new l(this.controlLayer,{icon:"edit",type:"primary",tooltip:this.graphInstance.options.labels.editNode,className:"absolute left-6 bottom-6 p-0 sm w-28 btn-bl",onClick:function(){"function"==typeof t.graphInstance.options.onEditNode&&t.graphInstance.options.onEditNode(t.nodeData)}}),new l(this.controlLayer,{icon:"remove",type:"danger",tooltip:this.graphInstance.options.labels.deleteNode,className:"absolute right-6 top-6 p-0 sm w-28 btn-tr",onClick:function(){"function"==typeof t.graphInstance.options.onDeleteNode&&t.graphInstance.options.onDeleteNode(t.nodeData)}}),new l(this.controlLayer,{icon:"expand",type:"primary",tooltip:this.graphInstance.options.labels.adjustNodeSize,className:"absolute right-6 bottom-6 p-0 sm w-28 btn-br",onClick:function(){t.graphInstance.tableController.startResizing(t)}})):(new l(this.controlLayer,{icon:"plus",type:"primary",className:"absolute left-6 top-6 p-0 sm w-28 btn-tl",tooltip:this.graphInstance.options.labels.addNode,onClick:function(){"function"==typeof t.graphInstance.options.onAddNode&&t.graphInstance.options.onAddNode(t.row,t.column)}}),this.graphInstance.options.totalRows>1&&this.row===this.graphInstance.options.totalRows-1&&(this.deleteRowBtn=new l(this.controlLayer,{icon:"delete_row",type:"danger",className:"absolute right-6 top-6 p-0 sm w-28 btn-tr",tooltip:this.graphInstance.options.labels.deleteRow,onClick:function(){"function"==typeof t.graphInstance.options.onDeleteRow&&t.graphInstance.options.onDeleteRow()}})),this.graphInstance.options.totalColumns>1&&this.column===this.graphInstance.options.totalColumns-1&&(this.deleteColBtn=new l(this.controlLayer,{icon:"delete_col",type:"danger",className:"absolute right-6 bottom-6 p-0 sm w-28 btn-br",tooltip:this.graphInstance.options.labels.deleteColumn,onClick:function(){if("function"==typeof t.graphInstance.options.onDeleteColumn)if(t.graphInstance.isEmptyColumns)t.graphInstance.options.onDeleteColumn();else{var e=t.graphInstance.options.columns[t.graphInstance.options.totalColumns-1];t.graphInstance.options.onDeleteColumn(e)}}}))),this.element.addEventListener("mouseenter",(function(){return t.onMouseEnter()})),this.element.addEventListener("mouseleave",(function(){return t.onMouseLeave()}))},t.prototype.onMouseEnter=function(){this.controlLayer.classList.remove("hidden"),this.deleteRowBtn&&(this.graphInstance.tableController.canDeleteRow&&this.graphInstance.lineController.canDeleteRow?this.deleteRowBtn.element.classList.remove("hidden"):this.deleteRowBtn.element.classList.add("hidden")),this.deleteColBtn&&(this.graphInstance.tableController.canDeleteColumn&&this.graphInstance.lineController.canDeleteColumn?this.deleteColBtn.element.classList.remove("hidden"):this.deleteColBtn.element.classList.add("hidden"))},t.prototype.onMouseLeave=function(){this.controlLayer.classList.add("hidden")},t.prototype.setIsTarget=function(t){t&&!this.isTarget?(this.isTarget=!0,this.element.style.opacity="0.4"):!t&&this.isTarget&&(this.isTarget=!1,this.element.style.opacity="1")},t}(),p=function(){function t(t,e,n,i){this.graphInstance=i,this.columnIndex=n,this.columnData=e,this.isLast=this.columnIndex===this.graphInstance.options.totalColumns-1,this.element=this.createElement(t)}return t.prototype.createElement=function(t){var e=n("th","tfgraph-th",t);if(this.columnData.title?e.innerHTML=this.columnData.title:e.classList.add("empty"),this.columnData.width){var i=this.columnData.width;switch(this.columnData.width){case"large":i="200";break;case"md":i="170";break;case"sm":i="130";break;case"xs":i="105";break;default:i=this.columnData.width}e.setAttribute("width",i)}else e.setAttribute("width","auto");return e.setAttribute("id","".concat(this.graphInstance.id,"_col_").concat(this.columnIndex)),e},t.prototype.setEditControls=function(){var t=this;this.controlLayer=n("div","tfgraph-cell-control-layer hidden",this.element),new l(this.controlLayer,{icon:"edit",type:"primary",className:"absolute left-6 top-6 p-0 sm w-28 btn-tl",tooltip:this.graphInstance.options.labels.editColumn,onClick:function(){"function"==typeof t.graphInstance.options.onEditColumn&&t.graphInstance.options.onEditColumn(t.columnData)}}),this.element.addEventListener("mouseenter",(function(){return t.onMouseEnter()})),this.element.addEventListener("mouseleave",(function(){return t.onMouseLeave()}))},t.prototype.onMouseEnter=function(){this.controlLayer.classList.remove("hidden")},t.prototype.onMouseLeave=function(){this.controlLayer.classList.add("hidden")},t}(),u=function(){function t(t,e,i){var o=this;this.graphInstance=i,this.disabled=!1,this.element=n("div","tfgraph-table-mask-cell",t),n("div","tfgraph-table-mask-node",this.element).innerText=e.nodeData.title,this.element.addEventListener("click",(function(){o.disabled||o.graphInstance.tableController.submitCellChange()}))}return t.prototype.setPositinAndSize=function(t){o(this.element,{top:t.top+"px",left:t.left+"px",width:t.width+"px",height:t.height+"px"})},t.prototype.disable=function(){this.disabled||(this.disabled=!0,this.element.classList.add("disabled"))},t.prototype.enable=function(){this.disabled&&(this.disabled=!1,this.element.classList.remove("disabled"))},t}(),m=function(){function t(t,e){this.graphInstance=e,this.element=n("div","tfgraph-cell-mask-layer hidden",e.element),this.tableGridRectList=t}return t.prototype.showMask=function(t){this.targetCell=t,this.targetCell.setIsTarget(!0),this.setFilteredOccupiedList(),this.maskBox=new u(this.element,this.targetCell,this.graphInstance),this.mouseGridRect=this.getMouseRect(),this.targetCellRect=this.getRectByRowAndColumn(this.targetCell.row,this.targetCell.column),this.setMaskBoxStatus()},t.prototype.setFilteredOccupiedList=function(){this.filteredOccupiedList=e.cloneDeep(this.graphInstance.tableController.occupiedList);for(var t=this.targetCell.row;t<this.targetCell.row+this.targetCell.rowSpan;t++)for(var n=this.targetCell.column;n<this.targetCell.column+this.targetCell.colSpan;n++)this.filteredOccupiedList[t][n]=0},t.prototype.setMaskBoxStatus=function(){this.graphInstance.tableController.isMovingCell?this.resultCellPositionAndSize={row:this.mouseGridRect.rowIndex,column:this.mouseGridRect.columnIndex,rowSpan:this.targetCell.rowSpan,colSpan:this.targetCell.colSpan}:this.resultCellPositionAndSize={row:Math.min(this.targetCellRect.rowIndex,this.mouseGridRect.rowIndex),column:Math.min(this.targetCellRect.columnIndex,this.mouseGridRect.columnIndex),rowSpan:Math.abs(this.targetCellRect.rowIndex-this.mouseGridRect.rowIndex)+1,colSpan:Math.abs(this.targetCellRect.columnIndex-this.mouseGridRect.columnIndex)+1};var t=this.getRectByRowAndColumn(this.resultCellPositionAndSize.row,this.resultCellPositionAndSize.column),e=this.getRectByRowAndColumn(this.resultCellPositionAndSize.row+this.resultCellPositionAndSize.rowSpan-1,this.resultCellPositionAndSize.column+this.resultCellPositionAndSize.colSpan-1);this.maskBox.setPositinAndSize({left:t.left,top:t.top,width:e.left-t.left+e.width+1,height:e.top-t.top+e.height+1});for(var n=!0,i=this.resultCellPositionAndSize.row;i<this.resultCellPositionAndSize.row+this.resultCellPositionAndSize.rowSpan;i++)for(var o=this.resultCellPositionAndSize.column;o<this.resultCellPositionAndSize.column+this.resultCellPositionAndSize.colSpan;o++)this.filteredOccupiedList[i][o]>0&&(n=!1);n?this.maskBox.enable():this.maskBox.disable()},t.prototype.startMask=function(t){this.element.classList.remove("hidden"),this.showMask(t)},t.prototype.stopMask=function(){this.element.classList.add("hidden"),i(this.maskBox.element),this.targetCell.setIsTarget(!1),this.maskBox=null},t.prototype.submitChange=function(){this.stopMask();var t={row:this.targetCell.row,column:this.targetCell.column,rowSpan:this.targetCell.rowSpan,colSpan:this.targetCell.colSpan};if(!e.isEqual(this.resultCellPositionAndSize,t)){var n=e.cloneDeep(this.targetCell.nodeData);this.targetCell.nodeData.row=this.resultCellPositionAndSize.row,this.targetCell.nodeData.column=this.resultCellPositionAndSize.column,this.targetCell.nodeData.rowSpan=this.resultCellPositionAndSize.rowSpan,this.targetCell.nodeData.colSpan=this.resultCellPositionAndSize.colSpan,"function"==typeof this.graphInstance.options.onChangeNode&&this.graphInstance.options.onChangeNode(this.targetCell.nodeData,n),this.graphInstance.refresh()}},t.prototype.getMouseRect=function(){var t,e=this.graphInstance.mousePosition.x,n=this.graphInstance.mousePosition.y;return this.tableGridRectList.forEach((function(i){n>i.top&&n<i.top+i.height&&e>i.left&&e<i.left+i.width&&(t=i)})),t},t.prototype.getRectByRowAndColumn=function(t,e){return this.tableGridRectList.find((function(n){return n.rowIndex===t&&n.columnIndex===e}))},t.prototype.onMouseMove=function(){var t=this.getMouseRect();e.isEqual(t,this.mouseGridRect)||t&&(this.mouseGridRect=t,this.setMaskBoxStatus())},t}(),g=function(){function t(t){this.graphInstance=t,this.element=n("table","tfgraph-table",this.graphInstance.element),this.initTableStatus()}return t.prototype.initTableStatus=function(){this.headerCells=[],this.cells=[],this.canDeleteColumn=!1,this.canDeleteRow=!1,this.occupiedList=[],this.isMovingCell=!1,this.isResizingCell=!1},t.prototype.renderTable=function(){this.initTableStatus(),this.element.innerHTML="",this.createHeader(),this.createTds(),this.createCells(),this.setControls()},t.prototype.setControls=function(){if("edit"===this.graphInstance.mode){var t=function(t,e,n){for(var i=!0,o=!0,s=0;s<e-1;s++)0!==t[s][n-1]&&(i=!1);for(s=0;s<n-1;s++)0!==t[e-1][s]&&(o=!1);return{canDeleteRow:o,canDeleteColumn:i}}(this.occupiedList,this.graphInstance.options.totalRows,this.graphInstance.options.totalColumns);this.canDeleteColumn=t.canDeleteColumn,this.canDeleteRow=t.canDeleteRow;var e=[],n=[];this.headerCells.forEach((function(t){t.setEditControls(),e.push({width:t.element.getBoundingClientRect().width+1,left:t.element.offsetLeft-1,columnIndex:t.columnIndex})})),this.cells.forEach((function(t){t.setEditControls()}));for(var i=0;i<this.graphInstance.options.totalRows;i++){var o=this.getMinRowSpanCell(i,1),s=o.element.getBoundingClientRect().height/o.rowSpan;n.push({top:o.element.offsetTop-1+(i-o.row)*s,height:s+1,rowIndex:i})}var r=[];n.forEach((function(t){e.forEach((function(e){r.push(Object.assign({},t,e))}))})),this.tableMask=new m(r,this.graphInstance)}this.setBottomControl()},t.prototype.getMinRowSpanCell=function(t,e){void 0===e&&(e=1);var n=null,i=this.cells.filter((function(e){return e.row===t}));if(0===i.length)t>0&&(n=this.getMinRowSpanCell(t-1,e+1));else{var o=20;i.forEach((function(t){t.rowSpan<o&&t.rowSpan>=e&&(o=t.rowSpan,n=t)}))}return n},t.prototype.onMouseMove=function(){(this.isMovingCell||this.isResizingCell)&&this.tableMask.onMouseMove()},t.prototype.startMoving=function(t){this.isMovingCell=!0,this.graphInstance.toolbar.disable(),this.tableMask.startMask(t)},t.prototype.stopMoving=function(){this.isMovingCell=!1,this.graphInstance.toolbar.enable(),this.tableMask.stopMask()},t.prototype.startResizing=function(t){this.isResizingCell=!0,this.graphInstance.toolbar.disable(),this.tableMask.startMask(t)},t.prototype.stopResizing=function(){this.isResizingCell=!1,this.graphInstance.toolbar.enable(),this.tableMask.stopMask()},t.prototype.submitCellChange=function(){this.isMovingCell=!1,this.isResizingCell=!1,this.graphInstance.toolbar.enable(),this.tableMask.submitChange()},t.prototype.setBottomControl=function(){var t=this;"edit"===this.graphInstance.mode&&!this.bottomControlEL&&this.graphInstance.options.totalRows<this.graphInstance.options.maxRows?(this.bottomControlEL=n("div","flex flex-row items-center justify-between mt-15",this.graphInstance.element),new l(this.bottomControlEL,{icon:"plus",label:this.graphInstance.options.labels.addRow,className:"flex-1",onClick:function(){"function"==typeof t.graphInstance.options.onAddRow&&t.graphInstance.options.onAddRow()}})):this.bottomControlEL&&(i(this.bottomControlEL),this.bottomControlEL=null)},t.prototype.createHeader=function(){var t=this;if(this.graphInstance.options.columns&&this.graphInstance.options.columns.length>0){var e=n("tr","tfgraph-tr");this.graphInstance.options.columns.forEach((function(n,i){var o=new p(e,n,i,t.graphInstance);t.headerCells.push(o)})),this.element.appendChild(e)}},t.prototype.createTds=function(){for(var t=0;t<this.graphInstance.options.totalRows;t++){var e=n("tr","tfgraph-tr");e.setAttribute("id","".concat(this.graphInstance.id,"_tr_").concat(t));var i=[];this.occupiedList.push(i);for(var o=0;o<this.graphInstance.options.totalColumns;o++){n("td","tfgraph-td",e).setAttribute("id","".concat(this.graphInstance.id,"_td_").concat(t,"_").concat(o)),i.push(0)}this.element.appendChild(e)}},t.prototype.createCells=function(){var t=this,e=[],n=this.graphInstance.options.nodes;n&&n.length>0&&n.forEach((function(n){if(n.colSpan>1||n.rowSpan>1)for(var i=n.column;i<n.column+n.colSpan;i++)for(var o=n.row;o<n.row+n.rowSpan;o++)i===n.column&&o===n.row||(e.push("".concat(t.graphInstance.id,"_td_").concat(o,"_").concat(i)),t.occupiedList[o][i]=1)})),e.forEach((function(t){return i(document.getElementById(t))}));for(var o=function(t){for(var i=function(i){if(!e.includes("".concat(s.graphInstance.id,"_td_").concat(t,"_").concat(i))){var o=n&&n.length>0?n.find((function(e){return e.row===t&&e.column===i})):null,r=document.getElementById("".concat(s.graphInstance.id,"_td_").concat(t,"_").concat(i));o&&(r.setAttribute("colSpan",o.colSpan.toString()),r.setAttribute("rowSpan",o.rowSpan.toString()),s.occupiedList[t][i]=1),s.cells.push(new d(r,o,t,i,s.graphInstance))}},o=0;o<s.graphInstance.options.totalColumns;o++)i(o)},s=this,r=0;r<this.graphInstance.options.totalRows;r++)o(r)},t}(),f=function(){function t(t,e){this.element=n("div","tfgraph-line",t.element);var i=e.positionA,o=e.positionB,s=e.thickness,r=void 0===s?2:s,a=e.isStart,l=void 0===a||a,h=e.isEnd,c=void 0===h||h;this.thickness=r,l&&this.toggleStartPoint(),c&&this.toggleEndArrow(),this.drawLine(i,o),this.element.addEventListener("mouseenter",(function(){return t.setHovered(!0)})),this.element.addEventListener("mouseleave",(function(){return t.setHovered(!1)})),this.element.addEventListener("dblclick",(function(){return t.onDoubleClick()}))}return t.prototype.setHoverd=function(t){void 0===t&&(t=!0),t?this.element.classList.add("hovered"):this.element.classList.remove("hovered")},t.prototype.drawLine=function(t,e){var n=t.x,i=t.y,o=e.x,s=e.y,r=Math.sqrt((o-n)*(o-n)+(s-i)*(s-i)),a=(n+o)/2-r/2,l=(i+s)/2-this.thickness/2,h=Math.atan2(s-i,o-n)*(180/Math.PI);this.element.style.width=r+this.thickness+"px",this.element.style.height=this.thickness+"px",this.element.style.left=a-.5*this.thickness+"px",this.element.style.top=l+"px",this.element.style.borderRadius=this.thickness+"px",this.element.style.transform="rotate(".concat(h,"deg)")},t.prototype.toggleStartPoint=function(){this.startPointEl?i(this.startPointEl):this.startPointEl=n("div","start-point",this.element)},t.prototype.toggleEndArrow=function(){this.endArrowEl?i(this.endArrowEl):this.endArrowEl=n("div","arrow",this.element)},t}(),w=function(){function t(t,e,i){this.element=n("div","tfgraph-line-group",t),this.isDrawingActive=e.isDrawingActive,this.anchorIds=e.anchorIds,this.graphInstance=i,this.drawLines()}return t.prototype.addLineSegment=function(t){this.anchorIds.includes(t)||(this.anchorIds.push(t),this.drawLines())},t.prototype.onDoubleClick=function(){this.hovered&&(this.isDrawingActive?this.graphInstance.lineController.endDrawLine():this.graphInstance.lineController.removeLineGroup(this))},t.prototype.drawLines=function(){var t=this;if(this.anchors=[],this.lines=[],0!==this.anchorIds.length){this.anchorIds.forEach((function(e){var n=t.graphInstance.anchorController.anchors.find((function(t){return t.id===e}));t.anchors.push(n)})),this.element.innerHTML="";var e=this.anchors.map((function(t){return{x:t.posX,y:t.posY}}));if(e.length>1)for(var n=0;n<e.length-1;n++){var i=new f(this,{positionA:e[n],positionB:e[n+1],thickness:2,isStart:0===n,isEnd:n===e.length-2&&!this.isDrawingActive});this.lines.push(i)}this.isDrawingActive&&(this.cursorLineStartPosition=e[e.length-1],this.cursorLine=new f(this,{positionA:this.cursorLineStartPosition,positionB:this.graphInstance.mousePosition,thickness:2,isStart:0===e.length,isEnd:!0}),this.lines.push(this.cursorLine))}},t.prototype.setHovered=function(t){void 0===t&&(t=!0),"edit"===this.graphInstance.mode&&(this.hovered=t,this.lines.forEach((function(e){e.setHoverd(t)})))},t.prototype.endDrawing=function(){this.isDrawingActive=!1,this.drawLines()},t.prototype.escapeDrawing=function(){this.cursorLine&&this.anchorIds.length>0&&(this.anchorIds.pop(),0===this.anchorIds.length?(i(this.element),this.graphInstance.lineController.lineAnchorIds=this.graphInstance.lineController.lineAnchorIds.filter((function(t){return t.length>1})),this.graphInstance.lineController.endDrawLine()):this.drawLines())},t.prototype.onMouseMove=function(t){if(this.cursorLine){var e=t.mousePosition;t.anchorController.hoveredAnchor&&!this.anchorIds.includes(t.anchorController.hoveredAnchor.id)&&(e={x:t.anchorController.hoveredAnchor.posX,y:t.anchorController.hoveredAnchor.posY}),this.cursorLine.drawLine(this.cursorLineStartPosition,e)}},t}(),v=function(){function t(t){this.graphInstance=t,this.element=n("div","tfgraph-line-layer",this.graphInstance.element);var i=this.graphInstance.options;i.lines&&Array.isArray(i.lines)?this.lineAnchorIds=i.lines:this.lineAnchorIds=[],this.originLineAnchorIds=e.cloneDeep(this.lineAnchorIds)}return t.prototype.renderLines=function(){var t=this;this.element.innerHTML="",this.lineAnchorIds.forEach((function(e){new w(t.element,{anchorIds:e,isDrawingActive:!1},t.graphInstance)})),this.setColAndRowDeletable()},t.prototype.startDrawLine=function(){this.isDrawingLine=!0,this.graphInstance.toolbar.disable(),o(this.element,{zIndex:"1"}),o(this.graphInstance.anchorController.element,{zIndex:"2"}),this.originLineAnchorIds=e.cloneDeep(this.lineAnchorIds)},t.prototype.endDrawLine=function(){this.isDrawingLine=!1,this.graphInstance.toolbar.enable(),o(this.element,{zIndex:"2"}),o(this.graphInstance.anchorController.element,{zIndex:"1"}),this.currentDrawingLine&&(this.currentDrawingLine.endDrawing(),this.currentDrawingLine.anchorIds.length<=1&&this.removeLineGroup(this.currentDrawingLine),this.currentDrawingLine=void 0),e.isEqual(this.originLineAnchorIds,this.lineAnchorIds)||this.onChangeLines()},t.prototype.setColAndRowDeletable=function(){var t=this,e=this.graphInstance.options.totalRows,n=this.graphInstance.options.totalColumns;this.canDeleteColumn=!0,this.canDeleteRow=!0,this.lineAnchorIds.forEach((function(i){i.forEach((function(i){var o=i.split("_"),s=o[1],r=o[2];parseInt(r)===n-1&&(t.canDeleteColumn=!1),parseInt(s)===e-1&&(t.canDeleteRow=!1)}))}))},t.prototype.onChangeLines=function(){this.setColAndRowDeletable(),"function"==typeof this.graphInstance.options.onChangeLines&&this.graphInstance.options.onChangeLines(this.lineAnchorIds)},t.prototype.removeLineGroup=function(t){i(t.element),this.lineAnchorIds=this.lineAnchorIds.filter((function(n){return!e.isEqual(n,t.anchorIds)})),e.isEqual(this.lineAnchorIds,this.originLineAnchorIds)||(this.originLineAnchorIds=e.cloneDeep(this.lineAnchorIds),this.onChangeLines())},t.prototype.createLineGroup=function(t){this.startDrawLine(),this.lineAnchorIds.push([t]),this.currentDrawingLine=new w(this.element,{anchorIds:this.lineAnchorIds[this.lineAnchorIds.length-1],isDrawingActive:!0},this.graphInstance)},t.prototype.addLineSegment=function(t){this.isDrawingLine&&this.currentDrawingLine&&this.currentDrawingLine.addLineSegment(t)},t.prototype.onMouseMove=function(){this.isDrawingLine&&this.currentDrawingLine&&this.currentDrawingLine.onMouseMove(this.graphInstance)},t}(),C=function(){function t(t,e,i,o,s,r){void 0===s&&(s=!1),void 0===r&&(r=!1);var a=this;if(this.id="",this.posX=0,this.posY=0,this.hidden=!1,this.bearing=t,this.isOffsetX=s,this.isOffsetY=r,this.row=e,this.column=i,this.elementTr=document.getElementById("".concat(o.id,"_tr_").concat(e)),this.elementCol=document.getElementById("".concat(o.id,"_col_").concat(i)),this.elementTr&&this.elementCol){this.element=n("div","tfgraph-anchor",o.anchorController.element),n("div","tfgraph-anchor-point",this.element);var l=n("div","tfgraph-anchor-area",this.element);n("div","tfgraph-anchor-circle",l),this.id="anchor_".concat(e,"_").concat(i,"_").concat(t,"_").concat(s?"offsetx":"normalx","_").concat(r?"offsety":"normaly"),this.element.setAttribute("id","".concat(o.id,"_").concat(this.id)),o.anchorController.anchors.push(this),this.setVisible("edit"===o.mode),this.setPosition(),this.element.addEventListener("click",(function(){o.lineController.isDrawingLine?o.lineController.addLineSegment(a.id):o.lineController.createLineGroup(a.id)})),this.element.addEventListener("mouseenter",(function(){o.anchorController.setHoveredAnchor(a)})),this.element.addEventListener("mouseleave",(function(){o.anchorController.hoveredAnchor.id===a.id&&o.anchorController.setHoveredAnchor(void 0)})),this.element.addEventListener("dblclick",(function(){o.lineController.isDrawingLine&&o.lineController.endDrawLine()}))}}return t.prototype.setOnePosition=function(t,e){this.posX=t,this.posY=e,this.element.style.left=t+"px",this.element.style.top=e+"px",this.element.setAttribute("title","xpos & ypos=".concat(t,",").concat(e))},t.prototype.setVisible=function(t){t?this.element.classList.remove("hidden"):this.element.classList.add("hidden")},t.prototype.setPosition=function(){var t=this.elementCol.offsetLeft+(this.isOffsetX?15:0),e=this.elementCol.offsetLeft+.5*this.elementCol.offsetWidth,n=this.elementCol.offsetLeft+this.elementCol.offsetWidth-(this.isOffsetX?15:0),i=this.elementTr.offsetTop+(this.isOffsetY?15:0),o=this.elementTr.offsetTop+.5*this.elementTr.offsetHeight,s=this.elementTr.offsetTop+this.elementTr.offsetHeight-(this.isOffsetY?15:0);switch(this.bearing){case"topleft":this.setOnePosition(t,i);break;case"top":this.setOnePosition(e,i);break;case"topright":this.setOnePosition(n,i);break;case"right":this.setOnePosition(n,o);break;case"bottomright":this.setOnePosition(n,s);break;case"bottom":this.setOnePosition(e,s);break;case"bottomleft":this.setOnePosition(t,s);break;case"left":this.setOnePosition(t,o);break;case"center":this.setOnePosition(e,o)}},t}(),b=function(){function t(t){this.graphInstance=t,this.anchors=[],this.element=n("div","tfgraph-anchor-layer",t.element)}return t.prototype.renderAnchors=function(){var t=this;this.element.innerHTML="",this.anchors=[],this.graphInstance.tableController.cells.forEach((function(e){t.createAnchors(e)}))},t.prototype.setHoveredAnchor=function(t){this.hoveredAnchor=t},t.prototype.resetPosition=function(){this.anchors&&this.anchors.length>0&&this.anchors.forEach((function(t){t.setPosition()}))},t.prototype.setAnchorsVisible=function(t){this.anchors&&this.anchors.length>0&&this.anchors.forEach((function(e){e.setVisible(t)}))},t.prototype.createAnchors=function(t){for(var e=t.row;e<t.row+t.rowSpan;e++)for(var n=t.column;n<t.column+t.colSpan;n++)0===e&&(new C("top",e,n,this.graphInstance),new C("topright",e,n,this.graphInstance),0===t.column&&new C("topleft",e,n,this.graphInstance)),0===n&&(new C("left",e,n,this.graphInstance),new C("bottomleft",e,n,this.graphInstance)),n===t.column+t.colSpan-1&&new C("right",e,n,this.graphInstance),e===t.row+t.rowSpan-1&&new C("bottom",e,n,this.graphInstance),n!==t.column+t.colSpan-1&&e!==t.row+t.rowSpan-1||new C("bottomright",e,n,this.graphInstance),t.hasNode&&(n===t.column&&(new C("left",e,n,this.graphInstance,!0,!1),e<t.row+t.rowSpan-1&&new C("bottomleft",e,n,this.graphInstance,!0,!1)),n===t.column+t.colSpan-1&&(new C("right",e,n,this.graphInstance,!0,!1),e<t.row+t.rowSpan-1&&new C("bottomright",e,n,this.graphInstance,!0,!1)),e===t.row&&(new C("top",e,n,this.graphInstance,!1,!0),n<t.column+t.colSpan-1&&new C("topright",e,n,this.graphInstance,!1,!0)),e===t.row+t.rowSpan-1&&(new C("bottom",e,n,this.graphInstance,!1,!0),n<t.column+t.colSpan-1&&new C("bottomright",e,n,this.graphInstance,!1,!0)));t.hasNode||new C("center",t.row,t.column,this.graphInstance)},t}(),I={totalColumns:8,totalRows:8,maxColumns:12,maxRows:30,labels:{editMode:"Edit Mode",previewMode:"Preview Mode",editColumn:"Edit Column",addColumn:"Add Column",deleteColumn:"Delete Column",addRow:"Add Row",deleteRow:"Delete Row",editNode:"Edit Node",addNode:"Add Node",deleteNode:"Delete Node",adjustNodeSize:"Adjust Node Size",moveNode:"Move Node"}},y=function(){function t(t,e){var n=this;if(this.onKeydown=function(t){"Enter"===t.code?n.lineController.isDrawingLine&&n.lineController.endDrawLine():"Escape"===t.code&&(n.lineController.isDrawingLine&&n.lineController.currentDrawingLine.escapeDrawing(),n.tableController.isMovingCell&&n.tableController.stopMoving(),n.tableController.isResizingCell&&n.tableController.stopResizing())},!t)throw new Error("no element is specified to initialize TableFlowGraph");this.baseElement=t,this.baseElement.getAttribute("id")?this.id=this.baseElement.getAttribute("id"):this.id="id"+(1e5*Math.random()).toFixed(0),this.init(e),window.addEventListener("resize",this,!1),window.addEventListener("keydown",this,!1),window.addEventListener("mousemove",this,!1),this.isAlive=!0}return t.prototype.init=function(t){if(this.baseElement.innerHTML="",this.options=Object.assign({},I,t),t.labels&&(this.options.labels=Object.assign({},I.labels,t.labels)),void 0!==this.options.rows&&(this.options.totalRows=this.options.rows.length),void 0!==this.options.columns&&(this.options.totalColumns=this.options.columns.length),this.options.columns&&0!==this.options.columns.length)this.isEmptyColumns=!1;else{this.options.columns=[],this.isEmptyColumns=!0;for(var e=0;e<this.options.totalColumns;e++)this.options.columns.push({width:"auto"})}this.options.totalRows>this.options.maxRows&&(this.options.totalRows=this.options.maxRows),this.options.totalColumns>this.options.maxColumns&&(this.options.totalColumns=this.options.maxColumns),this.options.isEditor?(this.mode="edit",this.toolbar=new c(this.baseElement,this)):this.mode="preview",this.element=n("div","tfgraph",this.baseElement),"edit"===this.mode&&this.element.classList.add("edit"),this.lineController=new v(this),this.anchorController=new b(this),this.tableController=new g(this),this.render()},t.prototype.render=function(){this.tableController.renderTable(),this.anchorController.renderAnchors(),this.lineController.renderLines()},t.prototype.handleEvent=function(t){switch(t.type){case"resize":this.onResize();break;case"mousemove":this.onMourseMove(t);break;case"keydown":this.onKeydown(t)}},t.prototype.onMourseMove=function(t){var e=this.element.getBoundingClientRect(),n=t.clientX-e.left,i=t.clientY-e.top;this.mousePosition={x:n,y:i},this.lineController.onMouseMove(),this.tableController.onMouseMove()},t.prototype.onResize=function(){var t,e,n,i=this;"edit"===this.mode&&(t=function(){i.refresh()},e=100,Number.isInteger(e)||(console.warn("Call debounce without a valid number"),e=300),function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];clearTimeout(n);var s=this;n=window.setTimeout((function(){t.apply(s,i)}),e)})()},t.prototype.refresh=function(t){var e=this;this.isAlive&&setTimeout((function(){var n=e.baseElement.getBoundingClientRect().height;o(e.baseElement,{height:n+"px"}),e.init(t||e.options),o(e.baseElement,{height:"auto"})}))},t.prototype.destroy=function(){this.isAlive&&(window.removeEventListener("resize",this,!1),window.removeEventListener("keydown",this,!1),window.removeEventListener("mousemove",this,!1),this.isAlive=!1)},t.prototype.changeMode=function(t){this.mode!==t&&(this.mode=t,"edit"===t?this.element.classList.add("edit"):this.element.classList.remove("edit"),this.anchorController.setAnchorsVisible("edit"===t),this.tableController.renderTable())},t}();t.TableFlowGraph=y,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=index.min.js.map
